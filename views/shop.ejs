<%- include('partials/header') %>
<h2 class="h4 mb-3">Shop</h2>

<form class="row g-3 mb-4" method="GET" action="/shop">
  <div class="col-md-4">
    <label class="form-label">Category</label>
    <select class="form-select" name="country">
      <option value="">All</option>
      <% options.countries.forEach(c => { %>
        <option value="<%= c %>" <%= (filters.country === c ? 'selected' : '') %>><%= c %></option>
      <% }) %>
    </select>
  </div>
  <div class="col-md-4">
    <label class="form-label">Product</label>
    <select class="form-select" name="platform">
      <option value="">All</option>
      <% options.platforms.forEach(p => { %>
        <option value="<%= p %>" <%= (filters.platform === p ? 'selected' : '') %>><%= p %></option>
      <% }) %>
    </select>
  </div>
  <div class="col-md-4 d-flex align-items-end">
    <button class="btn btn-brand-outline w-100">Apply Filters</button>
  </div>
</form>

<div class="row g-4">
  <% if (products.length === 0) { %>
    <div class="col-12">
      <div class="alert alert-info">No products found for the selected filters.</div>
    </div>
  <% } %>

  <% products.forEach(p => { %>
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 shadow-sm">
        <% if (p.imageUrl) { %>
          <img src="<%= p.imageUrl %>" class="card-img-top object-fit-cover" style="height: 180px;" alt="<%= p.name %>">
        <% } %>
        <div class="card-body d-flex flex-column">
          <h5 class="card-title"><%= p.name %></h5>
          <p class="card-text text-muted small mb-2"><strong>Category:</strong> <%= p.country %> | <strong>Product:</strong> <%= p.platform %></p>
          <p class="flex-grow-1"><%= p.description %></p>
          <p class="fw-bold mb-3">Price: NGN<%= (p.price || 0).toFixed(2) %></p>
          <% if (p.isSold) { %>
            <button class="btn btn-secondary" disabled>Sold</button>
          <% } else { %>
            <% if (currentUser) { %>
              <!-- <a href="/payment/<%= p._id %>" class="btn btn-brand">Buy</a> -->
               <form method="POST" action="/buy/<%= p._id %>">
  <button type="submit" class="btn btn-brand">Buy</button>
</form>

            <% } else { %>
              <a href="/login" class="btn btn-brand-outline">Login to Buy</a>
            <% } %>
          <% } %>
        </div>
      </div>
    </div>
  <% }) %>
</div>
<!-- Floating WhatsApp Customer Care -->
<a href="https://t.me/mendynationlogs" target="_blank"
   class="btn btn-success rounded-circle"
   style="position: fixed; bottom: 20px; right: 20px; z-index: 999; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
   ðŸ’¬
</a>



<%- include('partials/footer') %>
